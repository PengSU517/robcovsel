---
title: "Boston housing data"
output: 
  github_document:
    toc_dept: 1
---

# Include the Boston housing data analysis here

```{r }
data("Boston")
y = log(Boston$medv)
predictors = Boston%>%mutate(loglstat = log(lstat),logdis = log(dis))
x = robStandardize(predictors[, c("loglstat", "rm", "logdis", "tax", "ptratio", "nox", "age")])

{
  n = length(y)
  p = 10
  r = 0.5
  mu = rep(0,p)
  sigma = diag(rep(1^2,p))
  for (i in 1:p) {for (j in 1:p) {
    if (i !=j)sigma[i,j] = sqrt(sigma[i,i]*sigma[j,j])*r^abs(i-j)}}
  xr = MASS::mvrnorm(n,mu,sigma)
      
  e = 0.05
  gamma = 10
  bi = apply(matrix(0, nrow = n, ncol = p), 2, 
              function(xvec) {xvec[sample(x = 1:n, size = e*n)] = 1; return(xvec)})
      
  outlier = matrix(0,nrow = n,ncol=p)
  for (i in 1:n) {
    k = sum(bi[i,])
    if(k!=0){
      label = as.logical(bi[i,])
      muc = mu[label]+sigma[label,!label]%*%solve(sigma[!label,!label])%*%(xr[i,!label]-mu[!label])
      sigmac = sigma[label,label]-sigma[label,!label]%*%solve(sigma[!label,!label])%*%sigma[!label,label]
      outlier[i,label] = muc-gamma*sign(xr[i,label])*diag(sigmac)
    }
  }
  xr = xr*(1-bi)+outlier
      
  xx = as.matrix(cbind(x, xr))
  yy = y
      
}

lassofit = covlasso(xx,yy,cor.method = "pearson", scale.method = "norm", pda.method = F)$betahat_opt
sLTSfit = sparseLTS(xx,yy)$coefficients[-1]
sssfit = sparseshooting(xx,yy)$coef_ln[-1]
pairfit = covlasso(xx,yy,cor.method = "pair", scale.method = "qn", lmin = 0.1,adaptive = T)$betahat_opt
gaussrankfit = covlasso(xx,yy,cor.method = "gaussrank", scale.method = "qn", adaptive = T)$betahat_opt

```


