---
title: "Simulation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{simu}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)

#https://pengsu517.github.io/robcovsel
```

# Data generation settings 

Consider the linear regression model 
$$
y_i = \mathbf{x}_i^\top \pmb{\beta} + \varepsilon_i, i = 1,\ldots, n,
$$
in our simulations, we set $n = 100$, $p = 20$, $\pmb\beta = (1,2,1,2,1, \pmb 0_{p-5}^\top )^\top$, $\mathbf{x}_i$ is sampled from $N(\pmb 0,\pmb\Sigma_{xx})$ and $\varepsilon_i$ is sampled from $N(0,1^2)$. The correlation structure among variables is given by $\Sigma _{ij} = \rho^{|i-j|}$ and we set $\rho = 0.1, 0.5, 0.5, 0.7, 0.9$, seperately. 

Contamination proportions are set as $ 2\%$, $5\%$ and $10\%$ for all predictors separately. Outlying cells of all variables are randomly generated from $0.5 N(\gamma, 1)+ 0.5N(-\gamma, 1)$. We vary $\gamma$ over the set $\{0,2,4,6,8,10\}$ to simulate outliers with different magnitudes. When we apply appropriate $\gamma$'s, those cells will be outlying cells but not not necessarily marginal outliers.

For Lasso, ALGR and ALRP, we use the $\mathrm{BIC}$ as defined in (\ref{bic}) to choose the regularization tuning parameter $\lambda$. For sLTS and sShootingS, their default selection criteria are used. To assess the performance of the considered methods, we {use} the true positive rate (TPR), the false positive rate (FPR) and the balanced F-score ($\mathrm{F_1}$ score) {defined by}
$$
\mathrm{F_1} = \frac{\mathrm{TP}}{\mathrm{TP} + \frac{1}{2} (\mathrm{FP}+\mathrm{FN})},
$$
where TP {denotes} the true positive number, FP the false postive number and FN the false negative number, respectively. We run $1,000$ simulations for each scenario and use the average TPR, FPR and $\mathrm{F_1}$ score to measure the performance of each method.



```{r}
library(tidyverse)
library(gridExtra)
library(grid)
```



# Visualization 
```{r}
#data(result_simu_p20_tidy)
#library(tidyverse)


#summaryp20 = result1 %>% group_by(n,p,e,r,gamma,mtd) %>% summarise(
#  TPR = mean(tp/5, na.rm = T),FPR = mean(fp/(p-5), na.rm = T), F1 = mean(f1))%>%ungroup()
#save(summaryp20, file = "summaryp20.RData")

data("summaryp20")
summary = summaryp20

##summary = result1 %>% group_by(n,p,e,r,gamma,mtd) %>% summarise(
##  TPR = mean(tp/5, na.rm = T),FPR = mean(fp/(p-5), na.rm = T), F1 = mean(f1))%>%ungroup()
summary$e = factor(summary$e, labels = c("e = 2%","e = 5%","e = 10%"))
summary$r = as.numeric(summary$r)
summary1 = summary %>% filter(gamma %in% c(2,6,10))
summary1$gamma = factor(summary1$gamma, labels = c("Small outlier", "Medium outlier", "Large outlier"))
summary1 = summary1 %>% mutate(Method = factor(mtd, levels = c("ALRP",  "LRP", "ALGR",  "LGR", "aLasso", "Lasso", "sShootingS", "sLTS")))
summary1$Method = factor(summary1$Method, labels = c("ALRP",  "LRP", "ALGR",  "LGR", "ALasso", "Lasso", "sShootingS", "sLTS"))

summary1 = summary1 %>% mutate(adaptive = as.factor(grepl("A", Method)), mtdtype = 1*grepl("LRP", Method) + 2*grepl("LGR", Method) + 3*grepl("Lasso", Method) + 4*grepl("sShootingS", Method) + 5*grepl("sLTS", Method), mtdtype = as.factor(mtdtype))
#glimpse(summary1)

summary1$adaptive = factor(summary1$adaptive, levels = c("TRUE", "FALSE"))

```


```{r  fig.width=10, fig.height=10, echo=FALSE}
p1 = ggplot(data = summary1, aes(x = r,y = F1))+
  geom_line(aes(linetype = Method, color = Method))+ 
  geom_point(aes(shape = Method, color = Method)) + 
  scale_color_manual(values=c("red", "red", "orange", "orange","green", "green", "blue", "purple"))+
  scale_linetype_manual(values=c("solid", "dashed", "solid", "dashed","solid", "dashed", "dashed", "dashed"))+ 
  scale_shape_manual(values = c(16,1,16,1,16,1,1,1))+
  facet_grid(gamma~e) +
  scale_x_continuous(breaks=seq(0.1,0.9,0.2)) +
  labs(fill = "", x = "r: correlation coefficient", y = expression(F[1]))+ 
  guides(fill = guide_legend(title = "Thresholds")) +
  theme_light() +
  theme(axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14),
        legend.title = element_text(size=14), #change legend title font size
        legend.text = element_text(size=12),
        strip.text = element_text(size = 12))+
  
  theme(text= element_text(size=20), legend.position = "bottom")

p1


#ggsave("plots_20.eps", plot = p3, width = 10,height = 9)
```


```{r  fig.width=10, fig.height=10, echo=FALSE}
p2 = ggplot(data = summary1, aes(x = r,y = TPR))+
  geom_line(aes(linetype = Method, color = Method))+ 
  geom_point(aes(shape = Method, color = Method)) + 
  scale_color_manual(values=c("red", "red", "orange", "orange","green", "green", "blue", "purple"))+
  scale_linetype_manual(values=c("solid", "dashed", "solid", "dashed","solid", "dashed", "dashed", "dashed"))+ 
  scale_shape_manual(values = c(1:8))+
  facet_grid(gamma~e) +
  scale_x_continuous(breaks=seq(0.1,0.9,0.2)) +
  labs(fill = "", x = "r: correlation coefficient", y = "TPR")+ 
  guides(fill = guide_legend(title = "Thresholds")) +
  theme_light() +
  
  theme(text= element_text(size=20), legend.position = "bottom")

p2


#ggsave("plots_200_tpr.eps", plot = p2, width = 10,height = 9)
```

```{r  fig.width=10, fig.height=10, echo=FALSE}
p3 = ggplot(data = summary1, aes(x = r,y = FPR))+
  geom_line(aes(linetype = Method, color = Method))+ 
  geom_point(aes(shape = Method, color = Method)) + 
  scale_color_manual(values=c("red", "red", "orange", "orange","green", "green", "blue", "purple"))+
  scale_linetype_manual(values=c("solid", "dashed", "solid", "dashed","solid", "dashed", "dashed", "dashed"))+ 
  scale_shape_manual(values = c(1:8))+
  facet_grid(gamma~e) +
  scale_x_continuous(breaks=seq(0.1,0.9,0.2)) +
  labs(fill = "", x = "r: correlation coefficient", y = "FPR")+ 
  guides(fill = guide_legend(title = "Thresholds")) +
  theme_light() +
  
  theme(text= element_text(size=20), legend.position = "bottom")

p3


#ggsave("plots_200_fpr.eps", plot = p3, width = 10,height = 9)
```






